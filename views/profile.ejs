<!-- views/profile.ejs -->
<!doctype html>
<html lang="en" >
<head>
	<title>Profile</title>

  <meta name="viewport" content="width=device-width, initial-scale=1">

	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.6.4/angular.min.js"></script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/limonte-sweetalert2/7.0.6/sweetalert2.all.js"></script>

  

	<script>
	  function resizeIframe(obj) 
    {
		obj.style.height = obj.contentWindow.document.body.scrollHeight + 'px';
	  }
	</script>


  <style>
      body {
        width: 1px;
        min-width: 100%;
        *width: 100%;
        background-color: #ECEFF1;
        padding-bottom:60px;  
        padding-top: 60px;
      }

  </style>

  <script >

    function alt1(){
      var myVar = <%- JSON.stringify(message) %>;
      if(myVar=="err"){
        swal(
          'Oops...',
          'User Not Found!',
          'error'
        )
      }else if (myVar=="upfail") {
        swal({
          position: 'top-right',
          type: 'error',
          title: 'Wrong Inputs',
          showConfirmButton: false,
          timer: 2500
        })
      }else if (myVar=="Updated") {
        swal({
          position: 'top-right',
          type: 'success',
          title: 'Your profile updated',
          showConfirmButton: false,
          timer: 2500
        })
      }else if (myVar=="notadmin") {
        swal({
          position: 'top-right',
          type: 'error',
          title: 'Your not an admin',
          showConfirmButton: false,
          timer: 2500
        })
      }else if (myVar=="Uploaded") {
        swal({
          position: 'top-right',
          type: 'success',
          title: 'Upload Successful',
          showConfirmButton: false,
          timer: 2500
        })
      }else if (myVar=="notuploaded") {
        swal({
          position: 'top-right',
          type: 'error',
          title: 'Upload Failed',
          showConfirmButton: false,
          timer: 2500
        })
      }
    }
  </script>

  </head>

<%- include header.ejs %>

<body onload="alt1();">



<div class="container">
 <div ng-app="myApp" ng-controller="myCtrl">

  <br/>
  <br/>

	<div class="row">

		

		<div class="row-md-*">
		<div class="col-md-1" >
		</div>
		
 		<div class="col-md-3">

          <!-- Profile Image -->
          <div class="box box-primary">
            <div class="box-body box-profile">
              <img class="profile-user-img img-responsive img-circle" src=<%=user.image %> alt="User profile picture">

              <h3 class="profile-username text-center"><%= user.fname %> <%= user.lname %></h3>

              <p class="text-muted text-center"><%= user.designation %></p>

              <ul class="list-group list-group-unbordered">
                <li class="list-group-item">
                  <b>Change profile pic</b> <a class="pull-right  " href="" data-toggle="modal" data-target="#myupload"><span class="glyphicon glyphicon-open"></span></a>
                </li>
                <li class="list-group-item">
                  <b>File Uploader</b> <a class="pull-right " href="https://script.google.com/a/cloudpartners.biz/macros/s/AKfycbwuFo59ZlETZsr1Kb1-5Xtq_eftcqN_OaX_nPM_LWN1-N3YB5Lx/exec"><span class="glyphicon glyphicon-cloud-upload"></span></a>
                </li>
                
              </ul>

              <a href="#" class="btn btn-primary btn-block"><b>Follow</b></a>
            </div>
            <!-- /.box-body -->
          </div>
          <!-- /.box -->

          <!-- About Me Box -->
          <div class="box box-primary">
            <div class="box-header with-border">
              <h3 class="box-title">About Me</h3>
            </div>
            <!-- /.box-header -->
            <div class="box-body">

              <p class="text-muted">
                <%= user.description %>
              </p>

              <hr>

              <strong><i class="fa fa-map-marker margin-r-5"></i> Address</strong>

              <p class="text-muted"><%= user.address %></p>

              <hr>

              
            </div>
            <!-- /.box-body -->
          </div>
          <!-- /.box -->
        </div>


           <div class="col-md-4">
          <div class="nav-tabs-custom">
            <ul class="nav nav-tabs">
              <li class="active"><a href="#activity" data-toggle="tab">Details</a></li>
              <li><a href="#timeline" data-toggle="tab">Edit Details</a></li>
              <li><a href="#settings" data-toggle="tab">Calender</a></li>
            </ul>
            <div class="tab-content">
              <div class="active tab-pane" id="activity">
                <!-- Post -->
                <div class="post">
                  
				  <form >
                 <div class="form-group">
                    <label for="exampleInputPassword1">Employee Number</label><br>
                    <label class="control-label" style="color: #336666">EMP <%= user.login_idlogin %></label><!--datadase connecting point--> 
                  </div>

                  <div class="form-group" style="margin-top: 20px;" >
                    <label for="exampleInputEmail1">Email address</label><br>
                    <label class="control-label" style="color: #336666"><%= user.username %></label> <!--datadase connecting point-->
                  </div>

                  <div class="form-group">
                    <label for="exampleInputPassword1">First Name</label><br>
                    <label class="control-label" style="color: #336666" ><%= user.fname %></label><!--datadase connecting point--> 
                  </div>
                  <div class="form-group">
                    <label for="exampleInputPassword1">Last Name</label><br>
                    <label class="control-label" style="color: #336666"><%= user.lname %></label><!--datadase connecting point--> 
                  </div>
                  <div class="form-group">
                    <label for="exampleInputPassword1">Gender</label><br>
                    <label class="control-label" style="color: #336666"><%= user.gender %></label><!--datadase connecting point--> 
                  </div>
                  <div class="form-group">
                    <label for="exampleInputPassword1">NIC Number</label><br>
                    <label class="control-label" style="color: #336666"><%= user.nic %></label><!--datadase connecting point--> 
                  </div>
                  <div class="form-group">
                    <label for="exampleInputPassword1">EPF Number</label><br>
                    <label class="control-label" style="color: #336666"><%= user.EPF %></label><!--datadase connecting point--> 
                  </div>
                  <div class="form-group">
                    <label for="exampleInputPassword1">Birth Day</label><br>
                    <label class="control-label" style="color: #336666"><%= user.birthday %></label><!--datadase connecting point--> 
                  </div>
                  <div class="form-group">
                    <label for="exampleInputPassword1">Address</label><br>
                    <label class="control-label" style="color: #336666"><%= user.address %></label><!--datadase connecting point--> 
                  </div>
                  
                </form>
				  
                </div>
                <!-- /.post -->

                
              </div>
              <!-- /.tab-pane -->
              <div class="tab-pane" id="timeline">
                <!-- The timeline -->
                <div>
					               <form action="/updating" role="form"  method="post">
                               <div class="form-group" >
                                  <label for="exampleInputEmail1">First Name</label>
                                  <input type="text" name="fname2" class="form-control" ng-model="Fname" id="exampleInputEmail1" value="<%= user.fname %>">
                                </div>
                                <div class="form-group">
                                  <label for="exampleInputPassword1">Last Name</label>                                 
                                  <input type="text" name="lname2" class="form-control" ng-model="Lname" id="exampleInputPassword1" value="<%= user.lname %>">
                                </div>
                                <div class="form-group" >
                                   <label for="exampleInputEmail1">Gender</label>
                                   <%
                                   if(user.gender=="Male"){
                                   %>
                                   <label class="radio-inline"><input type="radio" name="gen" value="Male" checked="checked">Male</label>
                                   <label class="radio-inline"><input type="radio" name="gen" value="Female" >Female</label>
                                   <%
                                 }else{
                                   %>
                                   <label class="radio-inline"><input type="radio" name="gen" value="Male" >Male</label>
                                   <label class="radio-inline"><input type="radio" name="gen" value="Female" checked="checked">Female</label>
                                   <%
                                    }
                                   %>
                                </div>
                                 <div class="form-group" >
                                   <label for="exampleInputEmail1">NIC Number</label>
                                   <input type="text" name="nic2" class="form-control" ng-model="Enum" id="exampleInputEmail1" value="<%= user.nic %>" >
                                </div>
                                <div class="form-group">
                                      <label for="exampleInputPassword1">EPF Number</label>
                                     <input type="text" name="epf2" class="form-control" ng-model="EPFnum" id="exampleInputPassword1" value="<%= user.EPF %>">
                                 </div>
                                 <div class="form-group">
                                      <label for="exampleInputPassword1">Birthday</label>    
                                      <input type="data" name="birthday2" class="form-control" ng-model="Birthday" id="exampleInputPassword1" value="<%= user.birthday %>">
                                 </div>
                                 <div class="form-group" >
                                    <label for="comment">Contact Number</label>
                                    <input type="text" name="contact2" class="form-control" ng-model="Address" id="exampleInputEmail1" value="<%= user.contact %>" >
                                </div>
                                 <div class="form-group" >
                                    <label for="comment">Address</label>
                                    <input type="text" name="address2" class="form-control" ng-model="Address" id="exampleInputEmail1" value="<%= user.address %>" >
                                  </div>
                                  <div class="form-group" >
                                    <label for="comment">Designation</label>
                                    <input type="text" name="designation2" class="form-control" ng-model="Designetion" id="exampleInputEmail1" value="<%= user.designation %>" >
                                  </div>
                                  <div class="form-group">
                                    â€‹<label for="comment" >Description</label>
                                    <textarea name="description2" class="form-control" rows="5" id="comment"> <%= user.description %></textarea>
                                  </div>
                                  <div class="form-group">
                                   <input type="hidden" name="_method" value="put" />
                                   <button type="submit" class="btn btn-danger" ">Submit</button>
                                    
                                  </div>
                          
                       </form>
				</div>
              </div>
              <!-- /.tab-pane -->

              <!-- enter the user input data using a button -->

		 <p id="demo"></p>
         <div class="tab-pane" id="settings">
                <form class="form-horizontal">
                  <div class="form-group">
                    <label for="inputName" class="col-sm-2 control-label">Summary</label>

                    <div class="col-sm-10">
                      <input type="text" id="demoSummry" placeholder="Summary">
                    </div>
                  </div>
                  <div class="form-group">
                    <label for="inputEmail" class="col-sm-2 control-label">Start</label>

                    <div class="col-sm-10">
                      <input type="datetime-local" id="demoStartDate" placeholder="Event stert date and">
                    </div>
                  </div>
                  <div class="form-group">
                    <label for="inputName" class="col-sm-2 control-label">End</label>

                    <div class="col-sm-10">
                      <input type="datetime-local" id="demoEndDate" placeholder="Event close date and time">
                    </div>
                  </div>
                  <div class="form-group">
                    <label for="inputExperience" class="col-sm-2 control-label">Location</label>

                    <div class="col-sm-10">
                      <input type="text" id="demoLocation" placeholder="Location">
                    </div>
                  </div>
                  <div class="form-group">
                    <label for="inputSkills" class="col-sm-2 control-label">Description</label>

                    <div class="col-sm-10">
                      <input type="text" id="demoDescription" placeholder="Description about event">
                    </div>
                  </div>
                  
                  <div class="form-group">
                    <div class="col-sm-offset-2 col-sm-10">
                      <button type="button" onclick="document.getElementById('demo').innerHTML ;myFunction();">Try it
					<script src="https://apis.google.com/js/client.js?onload=myFunction"></script>
				</button>
                    </div>
                  </div>
                </form>
				<div class="panel panel-danger" id="result-panel"><div id="event-response"></div></div>
              </div>
              <!-- /.tab-pane -->
            </div>
            <!-- /.tab-content -->
          </div>
          <!-- /.nav-tabs-custom -->
        </div>
		<div class="col-md-4">
			<div class="embed-responsive embed-responsive-4by3">
                <center>
                <iframe class="embed-responsive-item" src="https://calendar.google.com/calendar/embed?src=cloudpartners.biz_mmfv7u05m6dpnrf2k1dcoe4kpg%40group.calendar.google.com&ctz=Asia/Colombo" style="border: 0"  frameborder="0" scrolling="no"></iframe>
                </center>
          </div>
		  
		  <div class="box box-primary">
            <div class="box-header with-border">
              <h3 class="box-title">Upcoming Events In My Calender</h3>
            </div>
            <!-- /.box-header -->
            <div class="box-body" >
			<pre id="content" style="height: 150px">
			</pre>
			<button id="authorize-button"  class="btn btn-primary">Authorize</button>
			<button id="signout-button" class="btn btn-primary" style="visibility : hidden">Sign Out</button>  
			  
            </div>
            <!-- /.box-body -->
          </div>
		</div>
      </div>  


<!-- Calender Section -->

	</div>

</div>



<!-- -->



    <!--  upload pop up menu  -->
<div class="modal fade" id="myupload" role="dialog">
    <div class="modal-dialog">
    
    <!-- Modal content-->
            <div class="modal-content">

              <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"></button>
                <h4 class="modal-title">Upload a picture</h4>
              </div>
              <div class="modal-body">
               
                    <form ref='uploadForm' 
                      id='uploadForm' 
                      action='/profilepic' 
                      method='post' 
                      encType="multipart/form-data">
                        <input type="file" name="sampleFile" />
                        <br/>
                        <input type='submit' value='Upload!' />
                    </form>
                         
              </div>
                            
                         
             </div>
          </div>
                      
        </div>





</div>
</div>
</div>
</div>
<br/>

	<script type="text/javascript">
      // Client ID and API key from the Developer Console
      var CLIENT_ID = '633621342907-g5a3e121npdtb8ms06mvsmc6ivcrlhbl.apps.googleusercontent.com';
      var API_KEY = 'AIzaSyBGAEL4JNkrdjBhoRpFqsqcWZN_nLZkdgw';

      // Array of API discovery doc URLs for APIs used by the quickstart
      var DISCOVERY_DOCS = ["https://www.googleapis.com/discovery/v1/apis/calendar/v3/rest"];

      // Authorization scopes required by the API; multiple scopes can be
      // included, separated by spaces.
      var SCOPES = "https://www.googleapis.com/auth/calendar.readonly";

      var authorizeButton = document.getElementById('authorize-button');
      var signoutButton = document.getElementById('signout-button');

      /**
       *  On load, called to load the auth2 library and API client library.
       */
      function handleClientLoad1() {
        gapi.load('client:auth2', initClient);
      }

      /**
       *  Initializes the API client library and sets up sign-in state
       *  listeners.
       */
      function initClient() {
        gapi.client.init({
          apiKey: API_KEY,
          clientId: CLIENT_ID,
          discoveryDocs: DISCOVERY_DOCS,
          scope: SCOPES
        }).then(function () {
          // Listen for sign-in state changes.
          gapi.auth2.getAuthInstance().isSignedIn.listen(updateSigninStatus);

          // Handle the initial sign-in state.
          updateSigninStatus(gapi.auth2.getAuthInstance().isSignedIn.get());
          authorizeButton.onclick = handleAuthClick1;
          signoutButton.onclick = handleSignoutClick;
        });
      }

      /**
       *  Called when the signed in status changes, to update the UI
       *  appropriately. After a sign-in, the API is called.
       */
      function updateSigninStatus(isSignedIn) {
        if (isSignedIn) {
          authorizeButton.style.display = 'none';
          signoutButton.style.display = 'block';
          listUpcomingEvents();
        } else {
          authorizeButton.style.display = 'block';
          signoutButton.style.display = 'none';
        }
      }

      /**
       *  Sign in the user upon button click.
       */
      function handleAuthClick1(event) {
        gapi.auth2.getAuthInstance().signIn();
      }

      /**
       *  Sign out the user upon button click.
       */
      function handleSignoutClick(event) {
        gapi.auth2.getAuthInstance().signOut();
      }

      /**
       * Append a pre element to the body containing the given message
       * as its text node. Used to display the results of the API call.
       *
       * @param {string} message Text to be placed in pre element.
       */
      function appendPre(message) {
        var pre = document.getElementById('content');
        var textContent = document.createTextNode(message + '\n');
        pre.appendChild(textContent);
      }

      /**
       * Print the summary and start datetime/date of the next ten events in
       * the authorized user's calendar. If no events are found an
       * appropriate message is printed.
       */
      function listUpcomingEvents() {
        gapi.client.calendar.events.list({
          'calendarId':'primary',
          'timeMin': (new Date()).toISOString(),
          'showDeleted': false,
          'singleEvents': true,
          'maxResults': 10,
          'orderBy': 'startTime'
        }).then(function(response) {
          var events = response.result.items;
          appendPre('');

          if (events.length > 0) {
            for (i = 0; i < events.length; i++) {
              var event = events[i];
              var when = event.start.dateTime;
              if (!when) {
                when = event.start.date;
              }
              appendPre(event.summary + ' (' + when + ')')
            }
          } else {
            appendPre('No upcoming events found.');
          }
        });
      }

    </script>

    <script async defer src="https://apis.google.com/js/api.js"
      onload="this.onload=function(){};handleClientLoad1()"
      onreadystatechange="if (this.readyState === 'complete') this.onload()">
    </script>
	
	<script type="text/javascript">
			
			// google api console clientID and apiKey (https://code.google.com/apis/console/#project:568391772772)
			var clientId = '633621342907-g5a3e121npdtb8ms06mvsmc6ivcrlhbl.apps.googleusercontent.com';
			var apiKey = 'AIzaSyBGAEL4JNkrdjBhoRpFqsqcWZN_nLZkdgw';

			// enter the scope of current project (this API must be turned on in the google console)
			var scopes = 'https://www.googleapis.com/auth/calendar';
			
			var text="text";
			var location123="maradana";
			var description123="About Company";
						function myFunction() {
					   
					    var ew=document.getElementById("demoStartDate").value;
						var now2 = new Date(ew);
						 now2.setSeconds(2);
						 now2.setMilliseconds(192);
						todaynew = now2.toISOString();

						 var demoEndDate=document.getElementById("demoEndDate").value;
						var now2 = new Date(demoEndDate);
						 now2.setSeconds(2);
						 now2.setMilliseconds(192);
						todayEnd = now2.toISOString();

						var samm=document.getElementById("demoSummry").value;
						text=samm;

						var location123demo=document.getElementById("demoLocation").value;
						location123=location123demo;

						var description123demo=document.getElementById("demoDescription").value;
						description123=description123demo;
						
						handleClientLoad();			    					      
					}
		
			// Oauth2 functions
			function handleClientLoad() {
				gapi.client.setApiKey(apiKey);
				window.setTimeout(checkAuth,1);
			}

			function checkAuth() {
				gapi.auth.authorize({client_id: clientId, scope: scopes, immediate: true}, handleAuthResult);
			}

			// show/hide the 'authorize' button, depending on application state
			function handleAuthResult(authResult) {
				var authorizeButton = document.getElementById('authorize-button');
				var resultPanel		= document.getElementById('result-panel');
				var resultTitle		= document.getElementById('result-title');
				
				if (authResult && !authResult.error) {						
					authorizeButton.style.visibility = 'hidden';			// if authorized, hide button
					resultPanel.className = resultPanel.className.replace( /(?:^|\s)panel-danger(?!\S)/g , '' )	// remove red class
					resultPanel.className += ' panel-success';				// add green class
					//resultTitle.innerHTML = 'Application Authorized'		// display 'authorized' text
					makeApiCall();											// call the api if authorization passed
				} else {													// otherwise, show button
					authorizeButton.style.visibility = 'visible';
					resultPanel.className += ' panel-danger';				// make panel red
					authorizeButton.onclick = handleAuthClick;				// setup function to handle button click
				}
			}
			
			// function triggered when user authorizes app
			function handleAuthClick(event) {
				gapi.auth.authorize({client_id: clientId, scope: scopes, immediate: false}, handleAuthResult);
				return false;
			}


			
			
			// function load the calendar api and make the api call
			function makeApiCall() {				
						gapi.client.load('calendar', 'v3', function() {					// load the calendar api (version 3)
					var event = {
					  'summary': text,
					  'location': location123,
					  'description': description123,
					  'start': {
					    'dateTime': todaynew,
					    'timeZone': 'Sri Lanka Standard Time (SLST)/GMT/UTC (UTC+05:30)'
					  },
					  'end': {
					    'dateTime': todayEnd,
					    'timeZone': 'Sri Lanka Standard Time (SLST)/GMT/UTC (UTC+05:30)'
					  },
					  
					  'reminders': {
					    'useDefault': false,
					    'overrides': [
					      {'method': 'email', 'minutes': 24 * 60},
					      {'method': 'popup', 'minutes': 10}
					    ]
					  }
					};

						var request = gapi.client.calendar.events.insert({
					  'calendarId': 'primary',
					  'resource': event
					});



					//handle the response from our api call
					request.execute(function(resp) {
						if(resp.status=='confirmed') {
							alert("create successfully");
						} else {
							alert("There was a problem");
						}
						
						console.log(resp);
					});
				});
			}
		</script>


</body>

</html>
